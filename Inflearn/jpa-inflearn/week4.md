## 연관관계 기초



**연관관계가 필요한 이유?**

- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다.



**연관 관계의 주인**

- 외래 키가 있는 곳을 주인으로 정해라.



**양방향 연관관계 주의**

- 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자
- 연관관계 편의 메소드를 생성하자
- 양방향 매핑시에 무한루프를 조심하자
  - ex) toString(), lombok, JSON 생성 라이브러리



**양방향 매핑 정리**

- 단방향 매핑만으로도 이미 연관관계 매핑은 완료
  - 단방향 매핑으로 설계를 끝내야 한다.
- 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가 
- JPQL 에서 역방향으로 탐색할 일이 많음
- 단방향 매핑을 잘하고 양방향은 필요할떄 추가(테이블 영향 X)





## 다양한 연관관계 매핑

**다대일**

객체와 테이블의 차이

- 테이블
  - 외래 키 하나로 양쪽 조인 가능
  - 방향이라는 개념 x
- 객체
  - 참조용 필드가 있는 쪽으로만 참조 가능
  - 한쪽만 참조하면 단방향
  - 양쪽이 서로 참조하면 양방향



# 고급 매핑

**상속관계 매핑** 

• 슈퍼타입 서브타입 논리 모델을 실제 물리 모델로 구현하는 방법 

• 각각 테이블로 변환 -> 조인 전략 

• 통합 테이블로 변환 -> 단일 테이블 전략 • 서브타입 테이블로 변환 -> 구현 클래스마다 테이블 전략



### 조인 전략

장점 

- 테이블 정규화 
- 외래 키 참조 무결성 제약조건 활용가능 
- 저장공간 효율화  



단점

- 조회시 조인을 많이 사용, 성능 저하 
- 조회 쿼리가 복잡함 
- 데이터 저장시 INSERT SQL 2번 호출



### 단일 테이블 전략

장점 

- 조인이 필요 없으므로 일반적으로 조회 성능이 빠름 
- 조회 쿼리가 단순함 



단점

- 자식 엔티티가 매핑한 컬럼은 모두 null 허용 
- 단일 테이블에 모든 것을 저장하므로 테이블이 커질 수 있다. 상 황에 따라서 조회 성능이 오히려 느려질 수 있다.



### 구현클래스 마다 테이블 전략

장점 

- 서브 타입을 명확하게 구분해서 처리할 때 효과적 
- not null 제약조건 사용 가능 



단점

- 여러 자식 테이블을 함께 조회할 때 성능이 느림(UNION SQL 필요) 
- 자식 테이블을 통합해서 쿼리하기 어려움